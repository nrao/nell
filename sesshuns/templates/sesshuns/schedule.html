{% extends "sesshuns/base_wide.html" %}

{% load custom %}

{% block title %}GBT Schedule{% endblock %}
{% block scripts %}
  <link type="text/css" href="/static/css/lib/themes/base/ui.all.css" rel="stylesheet" />
  <style type="text/css">
    .top_menu {font-size:120%}
    .day_header {background-color:#c3d9ff}
    .project_type {width:1%; text-align:center}
    .type_test {background-color:#87CEFA} 
    .type_astronomy {background-color:#EEEEEE}
    .type_maintenance {background-color:#98FB98}
    .moc_failure {background-color:#FF0000}
    .info{
        position:relative; /*this is the key*/
        z-index:24; background-color:#fff;
        color:#000;
        text-decoration:none}
    .info:hover{z-index:25; background-color:#ffffe0}
    .info span{display: none}
    .info:hover span{ /*the span will display just on :hover state*/
        display:block;
        position:absolute;
        top:2em; left:2em; width:15em;
        border:1px solid #000000;
        background-color:#ffffe0; color:#000;
        text-align: left}
  </style>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js"></script>
<!--  
  <link type="text/css" href="http://jqueryui.com/latest/themes/base/ui.all.css" rel="stylesheet" /> >
  <script type="text/javascript" src="http://jqueryui.com/latest/jquery-1.3.2.js"></script>
  <script type="text/javascript" src="http://jqueryui.com/latest/ui/ui.core.js"></script>
  <script type="text/javascript" src="http://jqueryui.com/latest/ui/ui.datepicker.js"></script>
-->  
  <script type="text/javascript">
  $(document).ready(function(){
    $("#id_start").datepicker();
    $("#id_end").datepicker();
    $("#id_until").datepicker();
    setTimeout('document.getCalendar.submit()', 1000*60*5);
  });
  </script>
{% endblock %}
{% block metatags %}
{% endblock %}
{% block content %}
  <center>
  <h1 class="loud">GBT Schedule</h1>
  <form name="getCalendar" action="/schedule/" method="POST">
  <p>
    <label for="id_start">Start:</label>
    <input type="text" name="start" id="id_start" title="Click once for calendar, click twice for previous entries" value="{{start|date:'m/d/Y'}}"/>
    <label for="id_days">Days:</label>
    <select name="days" id="id_days">
      {% for d in day_list %}
        {% ifequal d days %}
          <option selected="selected">{{d}}</option>
        {% else %}
          <option>{{d}}</option>
        {% endifequal %}
      {% endfor %}
    </select> &nbsp; 
    <input type="submit" value="View Schedule"/>
  </p>
  </form>
  <strong>
  Support Links:
  <a href="#" onClick="window.open('http://safe.nrao.edu/wiki/bin/view/GB/Observing/GbtFriends{{'%Y%m'|get_date}}', 'On-Duty Support Scientist', 'width=1000, height=700, scrollbars=yes');return true;">
    On-Duty Support Scientist
  </a>
  |
  <a href="#" onClick="window.open('https://staff.nrao.edu/wiki/bin/view/GB/AbsencesCalendar', 'Support Staff Absences & Contact Info', 'width=1000, height=700, scrollbars=yes');return true;">
    Support Staff Absences & Contact Info
  </a>
  |
  <a href="#" onClick="window.open('https://staff.nrao.edu/wiki/bin/view/GB/SupportSchedule2009', 'DSS Team Support Schedule', 'width=1000, height=700, scrollbars=yes');return true;">
    DSS Team Support Schedule
  </a>
  |
  <a href="#" onClick="window.open('https://staff.nrao.edu/wiki/bin/view/GB/TeamSchedule2009', 'DSS Team Absences & Contact Info', 'width=1000, height=700, scrollbars=yes');return true;">
    DSS Team Absences & Contact Info
  </a>
  <br/> 
  Helpful Links:
  <a href="#" onClick="window.open('https://staff.nrao.edu/wiki/bin/view/GB/BackupProjects', 'Backup Projects', 'width=1000, height=700, scrollbars=yes');return true;">Backup Projects</a>
  |
  <a href="#" onClick="window.open('/receivers', 'Receiver Schedule', 'width=1000, height=700, scrollbars=yes');return true;">Receiver Schedule</a>
  |
  <a href="#", onClick="window.open('http://www.gb.nrao.edu/~rmaddale/Weather/', 'High Frequency Forecasts', 'width=1000, height=700, scrollbars=yes');return true;">
    High Frequency Forecasts
  </a>
  | Ground Weather Forecasts (
  <a href="#", onClick="window.open('http://www.gb.nrao.edu/~rmaddale/WeatherNAM/ground.html', 'Ground Weather Forecasts (3.5 day)', 'width=1000, height=700, scrollbars=yes');return true;">
    3.5 day</a>
  ) (
  <a href="#", onClick="window.open('http://www.gb.nrao.edu/~rmaddale/WeatherGFS3/ground.html', 'Ground Weather Forecasts (7.5 day)', 'width=1000, height=700, scrollbars=yes');return true;">
    7.5 day</a>
  ) |
  <a href="#" onClick="window.open('https://bos.nrao.edu/resReports/roomChart?Start+Date={{calendar|get_cal_start|date:'m/d/Y'}}&End+Date={{calendar|get_cal_end|date:'m/d/Y'}}&Site=1', 'Room Reservations', 'width=1000, height=800, scrollbars=yes');return true;">
    Room Reservations
  </a>
  </strong>
  <br />
  <strong>
  <em>
  (All times in ET.  UTC = ET + {{today|get_utc_offset}} hours)
  </em>
  </strong>
  </center>
  <table>
    {% for day, ps in calendar %}
    <tr class="day_header"> 
      <th title="Start and End times for the start day (timezone). '+' indicates that the period continues on in an undisplayed date.">{{day|date:"D Y-m-d"}}</th>
      <th title="Project Type: 'A' : Astronomy, 'T' : Test, 'M' : Maintenance">Type</th>
      <th>Project ID</th>
      <th>Project Title</th>
      <th>PI</th>
      <th title="Ordered list of observers to contact for this project">Observers</th>
      <th>Friend</th>
      <th title="Receivers (Names and frequency ranges in GHz) = (RRI) Rcvr_RRI:  0.10 -  1.60, (342) Rcvr_342:  0.29 -  0.40, (450) Rcvr_450:  0.39 -  0.52, (600) Rcvr_600:  0.51 -  0.69, (800) Rcvr_800:  0.68 -  0.92, (1070) Rcvr_1070:  0.91 -  1.23, (L) Rcvr1_2:  1.15 -  1.73, (S) Rcvr2_3:  1.73 -  2.60, (C) Rcvr4_6:  3.95 -  6.10, (X) Rcvr8_10:  8.00 - 10.00, (Hol) Holography: 11.70 - 12.20, (Ku) Rcvr12_18: 12.00 - 15.40, (KFPA) RcvrArray18_26: 17.00 - 27.50, (K) Rcvr18_26: 18.00 - 26.50, (Ka) Rcvr26_40: 26.00 - 39.50, (Q) Rcvr40_52: 38.20 - 49.80, (MBA) Rcvr_PAR: 80.00 - 100.00">Rcvrs</th>
    </tr>
    {% for start, end,start_cutoff, end_cutoff, p in ps %}
      {% if requestor.isOperator and p|moc_reschedule %}
        <script type="text/javascript">
          window.open("/period/{{p.id}}/moc_reschedule", "MOC Failure", "width=1000,height=300");
        </script>
      {% endif %}
      {% if requestor.isOperator and p|moc_degraded %}
        <script type="text/javascript">
          window.open("/period/{{p.id}}/moc_degraded", "MOC Degraded", "width=1000,height=300");
        </script>
      {% endif %}
      <tr class="{{p|moc_class}}">
      {% if start_cutoff or end_cutoff %}
        {%if start_cutoff %}
          <td>+{{start|date:"H:i"}} - {{end|date:"H:i"}}</td>
        {% else %}
          <td>{{start|date:"H:i"}} - {{end|date:"H:i"}}+</td>
        {% endif %}
      {% else %}    
          <td>{{start|date:"H:i"}} - {{end|date:"H:i"}}</td>
      {% endif %}    
      {% ifequal p.session.project.project_type.type "non-science" %}
        {% if p.session.project.is_maintenance %}
          <td class="project_type type_maintenance" >{{p.session.project|project_type}}</td>
        {% else %}
          <td class="project_type type_test" >{{p.session.project|project_type}}</td>
        {% endif %}
      {% else %}
          <td class="project_type type_astronomy">{{p.session.project|project_type}}</td>
      {% endifequal %}
      <td>
      {% if not p.moc_met %}
        <blink>
      {% endif %}
        <a href="/project/{{p.session.project.pcode}}">{{p.session.project.pcode}}</a>
        {% if p.session.project.notes %}
          <a href="" class="info">(N)<span><p>Project Notes:</p>{{p.session.project.notes|escape|linebreaks}}</span></a>
        {% endif %}
      {% if not p.moc_met %}
        </blink>
      {% endif %}
      </td>
      {% ifequal p.session.project.project_type.type "science" %}
        <td>
          <a href="#" onClick="window.open('http://gbrescal.gb.nrao.edu/gbtobs/proposals.dbw?view=viewproposal&propcode={{p.session.project.pcode}}', 'Proposal Cover Page', 'width=1000, height=700, scrollbars=yes');return true;">{{p.session.project.name}}</a>
          {% if p|has_lost_time %}
            <br/>
            (Lost Time: {{p|get_lost_time}})
          {% endif %}
        </td>
      {% else %}
        {% if p.session.project.is_maintenance %}
          <td>
            <a href="http://gbrescal.gb.nrao.edu/webcal/webcal.dbw?view=day&date={{p.start|date:"Y-m-d"}}">{{p.session.name}}</a>
            {{rschedule|get_receiver_change:day}}
          </td>
        {% else %}
          <td>{{p.session.name}}</td>
        {% endif %}
      {% endifequal %}
      <td>
        <a href="/profile/{{p.session.project.principal_investigator.id}}">
          {{p.session.project.principal_investigator.last_name|pretty_none}}
        </a>
      </td>
      <td>
        {% for o in p.session.project.get_sanctioned_observers %}
          <span title="Phones: {{o.user.getStaticContactInfo.phones|format_list}}, Dynamic: {{o.user.contact_instructions}}, Reservations: {{o.user.getReservations|format_reservations}}">
            {{forloop.counter}}) <a href="/profile/{{o.user.id}}">{{o.user.last_name|pretty_none}}</a> 
          </span>
        {% endfor %}
      </td>
      <td>
        {% if p.session.project.friend %}
        <a href="#" onClick="window.open('https://staff.nrao.edu/wiki/bin/view/GB/AbsencesCalendar', 'Support Staff Absences & Contact Info', 'width=1000, height=700, scrollbars=yes');return true;">
          {{p.session.project.friend.last_name}}
        </a>
        {% else %}
          {{p.session.project.friend.last_name|pretty_none}}
        {% endif %}
      </td>
      <td>
        {% if p.session.project.is_maintenance %}
          {{rschedule|get_receivers:day}}
        {% else %}
          {{p.receiver_list}}
        {% endif %}
      </td>
    </tr>
    {% endfor %}
    {% endfor %}
  </table>
</body>  


{% endblock %}
